(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-637675ac"],{4006:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"pages"},[o("div",{staticClass:"coursePage",attrs:{id:"coursePage"}},[o("header",{staticClass:"bar-title"},[o("mt-header",{attrs:{fixed:"",title:"添加课程"}},[o("mt-button",{attrs:{slot:"left"},on:{click:e.back},slot:"left"},[o("i",{staticClass:"backicon iconfont icon-fanhui"})])],1)],1),o("div",{staticClass:"content"},[o("label",{staticClass:"cover"},[o("img",{attrs:{src:e.course.cover,id:"cover"}}),o("input",{staticStyle:{display:"none"},attrs:{id:"coverInput",type:"file",accept:"image/*"},on:{change:function(t){e.openCropper("cover")}}})]),o("div",{staticClass:"course-cells"},[o("div",{staticClass:"course-cell"},[o("div",{staticClass:"course-cell__bd"},[o("mt-field",{attrs:{placeholder:"请输入课程标题",type:"text"},model:{value:e.course.title,callback:function(t){e.$set(e.course,"title",t)},expression:"course.title"}})],1)]),o("div",{staticClass:"course-cell"},[o("div",{staticClass:"course-cell__bd course-flex-item"},[o("mt-field",{attrs:{placeholder:"请输入课程描述",type:"textarea",rows:"4",attr:{maxlength:50}},model:{value:e.course.desc,callback:function(t){e.$set(e.course,"desc",t)},expression:"course.desc"}}),o("div",{staticClass:"textarea-counter"},[o("span",{},[e._v(e._s(e.course.desc.length))]),e._v("/50")])],1)])]),o("div",{staticClass:"button"},[o("mt-button",{attrs:{type:"primary",size:"large"},on:{click:e.addCourse}},[e._v("提交")])],1)]),e.inCropPage?o("div",{key:"inCropPage",staticClass:"view-content avatar-cropper"},[o("header",{staticClass:"bar-title"},[o("mt-header",{attrs:{fixed:""}},[o("mt-button",{attrs:{slot:"left",icon:"back"},on:{click:e.cancelCrop},slot:"left"},[e._v("取消")]),o("mt-button",{attrs:{slot:"right"},on:{click:e.confirmCrop},slot:"right"},[e._v("确定")])],1)],1),o("img",{attrs:{id:"avatarSource",src:""}})]):e._e()])])},c=[],s=o("d00c"),r=o("1157"),i=o.n(r),n=(o("0b1a"),o("76a0")),l=(o("9515"),{components:{},created:function(){},data:function(){return{course:{title:"",desc:"",cover:"",coverUrl:""},inCropPage:!1}},computed:{},methods:{openCropper:function(e){n["Indicator"].open("图片加载中");var t=document.getElementById(e+"Input").files;if("undefined"==typeof FileReader)return Object(n["MessageBox"])("您的浏览器不支持FileReader！"),!1;if(0==t.length||!/image\/\w+/.test(t[0].type))return Object(n["MessageBox"])("请选择图像文件"),!1;this.inCropPage=!0;var o=new FileReader;o.readAsDataURL(t[0]),o.onload=function(e){var t=e.target.result,o=new Image;o.src=t,o.onload=function(){n["Indicator"].close(),i()("#avatarSource").attr("src",t),i()("#avatarSource").cropper({viewMode:1,dragMode:"move",aspectRatio:1,autoCropArea:.7,restore:!1,guides:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,ready:function(){}})}}},cancelCrop:function(){this.inCropPage=!1,document.getElementById("coverInput").value=""},confirmCrop:function(){var e=n["Indicator"];e.open("图片裁剪中");var t=this;t.$nextTick(function(){var o;o=i()("#avatarSource").cropper("getCroppedCanvas");var a=o.toDataURL();t.inCropPage=!1,t.uploadCover(a,e)})},addCourse:function(){var e=this;this.course.coverUrl?(n["Indicator"].open("正在添加"),console.log(this.course),this.axios.post(s["a"]+"/chatInfo/saveOne.inf",this.Qs.stringify({chatTitle:this.course.title,chatTheme:this.course.title,themeDesc:this.course.desc,themePic:this.course.coverUrl,tokenId:localStorage.getItem("tokenId"),timestamp:(new Date).getTime()})).then(function(t){if(t.data.opSuccess){n["Indicator"].close();var o=Object(n["Toast"])("添加成功");setTimeout(function(){o.close(),e.$router.back()},500)}else n["Indicator"].close(),"0000"===t.data.errCode&&CZ.redirectToLogin(),Object(n["MessageBox"])(t.data.errMsg||"添加失败，请与官方联系！")}).catch(function(e){n["Indicator"].close(),Object(n["MessageBox"])("网络异常，请检查网络")})):Object(n["Toast"])("请上传封面")},uploadCover:function(e,t){var o=this;t.close(),this.axios.post(s["a"]+"/chatInfo/uploadCourseCoverPic.inf",this.Qs.stringify({tokenId:localStorage.getItem("tokenId"),imageData:e})).then(function(t){n["Indicator"].close(),t.data.opSuccess?(o.course.cover=e,o.course.coverUrl=t.data.themePic,document.getElementById("coverInput").value=""):("0000"===t.errCode&&CZ.redirectToLogin(),t.errMsg?Object(n["MessageBox"])("data.errMsg"):Object(n["MessageBox"])("上传失败，请联系管理员"))}).catch(function(e){n["Indicator"].close(),navigator.onLine?Object(n["MessageBox"])("上传的图片过大，请裁剪或更换较小的图片"):Object(n["MessageBox"])("网络异常，请检查网络")})},back:function(){this.$router.back()}}}),u=l,d=(o("d9a8"),o("2877")),p=Object(d["a"])(u,a,c,!1,null,"71257f6e",null);p.options.__file="AddCourse.vue";t["default"]=p.exports},"7a4c":function(e,t,o){},9515:function(e,t,o){},d9a8:function(e,t,o){"use strict";var a=o("7a4c"),c=o.n(a);c.a}}]);